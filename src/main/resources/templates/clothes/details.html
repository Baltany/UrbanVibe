<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>UrbanVibe</title>
    <link rel="icon" href="img/UrbanVibeICON.ico" type="image/x-icon">
    <link rel="shortcut icon" href="img/UrbanVibeICON.ico" type="image/x-icon">
    <th:block th:replace="~{clothes/clothes.html :: styles}"></th:block>

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 0;
            color: #333;
        }

        .details-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .details-content {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-top: 5rem;
        }

        .details-left {
            width: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .details-image {
            max-width: 100%;
            max-height: 600px;
            object-fit: cover;
            border-radius: 8px;
        }

        .details-right {
            width: 45%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .details-right h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .details-right p {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .details-right ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 5px;
        }

        .details-right ul li {
            font-size: 1rem;
            padding: 15px 20px;
            border: 1px solid #ccc;
            border-radius: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .details-right ul li:hover {
            border-color: #000;
            background-color: #f7f7f7;
        }

        .details-right ul li.active {
            border-color: #000;
            background-color: #000;
            color: #fff;
        }

        .details-right button {
            padding: 15px;
            background-color: #000;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .details-right button:hover {
            background-color: #333;
        }

        .added {
            background-color: green;
            cursor: default;
        }

        .subtitle {
            margin-top: -1rem;
        }

        .error-message {
            color: red;
            margin-bottom: 10px;
            display: none;
        }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <th:block th:replace="~{clothes/clothes.html :: menu-header}"></th:block>
    <th:block th:replace="~{clothes/clothes.html :: menu-script}"></th:block>
</head>
<body>
    <main>
        <div class="details-container">
            <div class="details-content">
                <div class="details-left">
                    <img th:src="@{${clothe.image}}" alt="Imagen de la ropa" class="details-image" id="details-image">
                </div>
                <div class="details-right">
                    <h1 th:text="${clothe.description}" id="description">Descripción</h1>
                    <p class="subtitle" id="subtitle"><strong><span th:text="${clothe.price} + '€'">0.00€</span></strong></p>
                    <p>Stock:<strong><span th:text="${clothe.stock} + ' unidades'"></span></strong></p>
                    <p><span><strong>Categoría</strong></span>
                        <ul>
                            <li th:each="category : ${clothe.categoryList}" th:text="${category.category}">Categoría</li>
                        </ul>
                    </p>
                    <p>
                        <span><strong>Tallas disponibles</strong></span>
                        <ul>
                            <li th:each="size : ${clothe.sizeList}"
                                th:text="${size.size}"
                                class="size-option"
                                th:attr="data-size=${size.size}">Talla</li>
                        </ul>
                        <p class="error-message" id="error-message">Por favor, selecciona una talla.</p>

                    </p>
                    <button id="addToCartButton" type="submit" class="addToCart">Añadir al carrito</button>
                </div>
            </div>
        </div>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const addToCartButton = document.getElementById("addToCartButton");
            const sizeOptions = document.querySelectorAll(".size-option");
            const errorMessage = document.getElementById("error-message");
        
            // Verificar que los elementos existen
            console.log("addToCartButton:", addToCartButton);
            console.log("sizeOptions:", sizeOptions);
            console.log("errorMessage:", errorMessage);
        
            if (!addToCartButton || sizeOptions.length === 0 || !errorMessage) {
                console.error("No se encontraron algunos elementos necesarios en el DOM.");
                return;
            }
        
            sizeOptions.forEach(option => {
                option.addEventListener("click", function() {
                    sizeOptions.forEach(opt => opt.classList.remove("active"));
                    option.classList.add("active");
                    errorMessage.style.display = 'none';
                });
            });
        
            addToCartButton.addEventListener("click", function(event) {
                event.preventDefault();
                const selectedSize = document.querySelector(".size-option.active");
                if (selectedSize) {
                    const size = selectedSize.getAttribute('data-size');
                    const clothe = {
                        description: document.getElementById('description').innerText,
                        price: document.querySelector('#subtitle strong span').innerText,
                        size: size,
                        image: document.getElementById('details-image').src
                    };
        
                    // Guardar en localStorage
                    let cart = JSON.parse(localStorage.getItem('cart')) || [];
                    cart.push(clothe);
                    localStorage.setItem('cart', JSON.stringify(cart));
        
                    console.log(`Añadiendo al carrito: Talla ${size}`);
                    addToCartButton.innerText = "Añadido!";
                    addToCartButton.classList.add("added");
                    addToCartButton.disabled = true;
        
                    // Redirigir y abrir el carrito
                    setTimeout(() => {
                        window.location.href = "/clothes?openCart=true";
                    }, 500);
                } else {
                    errorMessage.style.display = 'block';
                }
            });
        
            // Abrir carrito si el parámetro openCart está en la URL
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('openCart') === 'true') {
                // Lógica para abrir el carrito
                console.log("Carrito abierto");
                // Aquí puedes agregar la lógica para abrir tu carrito
            }
        });
        </script>
</body>
</html>
